"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{!r&&c["return"]&&c["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],i=0;i<r;i++)if(t=n[i],e.call(o,t,i,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r=parseInt(arguments[1],10)||0;if(r>=n)return!1;var o;for(r>=0?o=r:(o=n+r,o<0&&(o=0));o<n;){var i=t[o];if(e===i||e!==e&&i!==i)return!0;o++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),angular.module("castifyExt.ui.micLevel",["w69b.webrtc","castifyExt.audioContextPool","castifyExt.appOptions","w69b.throttle","castifyExt.appOptions"]).factory("micLevelFactory",["webrtc","audioContextPool","$rootScope","appOptions","$q",function(e,t,n,r,o){function i(){function i(e){return function(){var t=arguments,n=o.defer();return(g||o.when())["finally"](function(){var r=e.apply(null,t);n.resolve(r)}),g=n.promise,g["finally"](function(){g=null}),n.promise}}function a(){var e=w.analyser;e&&(p||(p=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(p),v=-1)}function c(){v=Math.max.apply(null,p)/255}function u(e){if(m)throw Error();d=e,m=t.acquire();var n=m,r=n.createMediaStreamSource(e),o=n.createAnalyser(),i=n.createGain();i.gain.value=x,o.smoothingTimeConstant=.3,o.fftSize=32,o.minDecibels=-70,o.maxDecibels=-10;var c=n.createScriptProcessor(2048,2,1);c.onaudioprocess=a,r.connect(i),i.connect(o),o.connect(c),c.connect(n.destination),w.input=r,w.analyser=o,w.capture=c,w.gain=i}function s(){var t={echoCancellation:r.localValues.micAudioProcessing};return h&&(t.sourceId=h),e.getUserMedia({audio:{mandatory:t},video:!1})}function l(){d&&d.getTracks().forEach(function(e){e.stop()}),d=null}function f(e){x=e,w.gain&&(w.gain.gain.value=e)}var p,d,h,m,g,y={},w={},v=0,b=0,x=1,S=angular.noop;return y.start=i(function(){var e=null;return b||(S=n.$watch(function(){return r.localValues.micGain},f),e=s().then(u)),++b,e}),y.setSourceId=i(function(e){if(h=e,l(),w.input)return s().then(function(e){w.input.disconnect(),w.input=m.createMediaStreamSource(e),w.input.connect(w.gain)})}),y.stop=i(function(){b&&!--b&&(angular.forEach(w,function(e){e.disconnect()}),w={},l(),v=0,t.release(m),m=null,S())}),y.getVolume=function(){return v<0&&c(),v},y}return i}]).directive("cfMicLevel",["micLevelFactory","$window","$timeout",function(e,t,n){function r(){var e=Object.create(HTMLCanvasElement.prototype);e.attachedCallback=function(){this.dispatchEvent(new Event("attached"))},e.detachedCallback=function(){this.dispatchEvent(new Event("detached"))},document.registerElement("cf-mic-canvas",{prototype:e,"extends":"canvas"})}function o(t){if(i.has(t))return i.get(t);var n=e();return n.setSourceId(t),i.set(t,n),n}r();var i=new Map;return{restrict:"E",replace:!0,scope:{sourceId:"=?"},template:'<canvas class="cf-mic-level" is="cf-mic-canvas"></canvas>',link:function(e,r,i){function a(){p.clearRect(0,0,f.width,f.height),d?p.fillRect(0,0,Math.round(l.getVolume()*f.width),f.height):p.fillRect(0,f.height,f.width,-Math.round(l.getVolume()*f.height)),s=t.requestAnimationFrame(a)}function c(){m||(m=!0,l.start(),s=t.requestAnimationFrame(a))}function u(){m&&(m=!1,t.cancelAnimationFrame(s),l.stop())}var s,l=o(e.sourceId),f=r[0],p=f.getContext("2d"),d="horizontal"===i.orientation,h=!1,m=!1;n(function(){h||c()},0),r.bind("attached",function(){h=!1,c()}),r.bind("detached",function(){h=!0,u()});var g;g=d?p.createLinearGradient(0,0,f.width,0):p.createLinearGradient(0,f.height,0,0),g.addColorStop(0,"#0f0"),g.addColorStop(.7,"#ff0"),g.addColorStop(1,"#f00"),p.fillStyle=g,r.bind("$destroy",u),e.$watch("sourceId",function(e,t){if(e!==t){console.log("using new id",e);var n=m;u(),l=o(e),n&&c()}})}}}]).directive("cfMicLevelSlider",["appOptions","throttle","$window",function(e,t,n){return{restrict:"E",replace:!0,scope:{},templateUrl:"components/castifyExt/ui/mic-level/mic-level-slider.html",link:function(r){function o(){i.flush()}var i=t(e.saveLocal.bind(e),1e3),a=angular.element(n),c=!1;r.$watch("micGainRange",function(t,n){c&&t!==n&&(t=Math.exp(Number(t)),e.localValues.micGain=t,i())}),e.loadedPromise.then(function(){var t=e.localValues.micGain;t=Math.log(t),r.micGainRange=t,c=!0}),a.bind("unload",o),r.$on("$destroy",function(){a.unbind("unload",o),o()})}}}]),angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[],n={};return n.acquire=function(){return t.length?t.pop():new e.AudioContext({latencyHint:"playback"})},n.release=function(e){t.push(e)},n}]),angular.module("castifyExt.appOptions",["w69b.chromeStorage","castifyExt.enterprisePolicy"]).factory("appOptions",["chromeStorage","$rootScope","$q","enterprisePolicy",function(e,t,n,r){function o(e){return r.options.hasOwnProperty(e)}function i(e){return r.options[e]}var a={notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!1,enableDiskSpaceWatcher:!0,notifySyncProgress:!0,notifyEditProgress:!0,enableAnalytics:!0,enableCrashReports:!1,showDrawingToolsHint:!0,showEditToolsHint:!0,enableWindowPicker:!0,encoder:null,audioCodec:null},c={micGain:1,micAudioProcessing:!0,defaultEncoder:null},u=!1,s={},l=angular.copy(a);return s.localValues=angular.copy(c),s.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),managed:r.loadedPromise}).then(function(e){angular.extend(l,e.sync),angular.extend(s.localValues,e.local),u=!0}),s.values={},Object.keys(a).forEach(function(e){Object.defineProperty(s.values,e,{enumerable:!0,get:function(){return o(e)?i(e):l[e]},set:function(t){l[e]=t}})}),s.save=function(){return e.sync.setSingle("options",l)},s.saveLocal=function(){return e.local.setSingle("options",s.localValues)},s.isLoaded=function(){return u},s.isSetByEnterprisePolicy=function(e){return o(e)},e.onChanged.addListener(function(e,n){"sync"==n&&e.options&&(angular.extend(l,e.options.newValue),t.$$phase||t.$digest()),"local"==n&&e.options&&(angular.extend(s.localValues,e.options.newValue),t.$$phase||t.$digest())}),s}]),angular.module("castifyExt.backgroundTool",["w69b.chromeRuntime"]).factory("backgroundTool",["chromeRuntime","$q","$log","$rootScope",function(e,t,n,r){function o(){var n=t.defer();return e.onMessage.addListener(function r(t){"bg:loaded"===t&&(e.onMessage.removeListener(r),n.resolve())}),e.sendMessage("bg:load")["catch"](angular.identity),n.promise}var i,a={};return a.portHelper=function(n,i){var a,c={};return c.getPort=function(){var r=i===!1?t.when():o();return r.then(function(){return a||(a=e.connect({name:n})),a})},c.postMessage=function(e,t){return c.getPort().then(function(n){return n.postMessage({type:e,data:t})})},c.installHandlers=function(e){function t(t){e.hasOwnProperty(t.type)&&e[t.type](t.data),r.$$phase||r.$apply()}function n(){c.getPort().then(function(e){e.onMessage.removeListener(t)})}return c.getPort().then(function(e){e.onMessage.addListener(t)}),n},c},a.loadBackground=function(){return i||(i=o()),i},a}]),angular.module("castifyExt.recordTool",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry","castifyExt.hdpiTool","w69b.webrtc","w69b.chromeStorage","w69b.chromeWindows","w69b.spawn","w69b.chromeSystem"]).factory("recordTool",["chromeStorage","$window","webrtc","connectedApps","appRegistry","hdpiTool","spawn","chromeSystem","castifyConfig","chromeWindows",function(e,t,n,r,o,i,a,c,u,s){function l(){return t.navigator.userAgent}function f(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function p(){return l().indexOf("CrOS")>=0}function d(){return l().indexOf("Mac OS")>=0}function h(){return l().indexOf("CrOS arm")>=0}function m(){return l().indexOf("CrOS x86_64")>=0}function g(){return h()?5:(m(),30)}function y(e){return n.getSources().then(function(t){function n(e,n){return t.some(function(t){return t.kind===e&&t.label&&(!n||n===t.id)})}return e.audio.mic&&(n("audio")?e.audio.micSourceId&&!n("audio",e.audio.micSourceId)&&delete e.audio.micSourceId:e.audio.mic=!1),n("video")?e.camSourceId&&!n("video",e.camSourceId)&&delete e.camSourceId:("cam"===e.captureSource&&(e.captureSource="tab"),e.embedWebcam&&(e.embedWebcam=!1)),e})}function w(e){return e.autoShareApp?r.isConnected(e.autoShareApp.id).then(function(t){return t||delete e.autoShareApp,e}):e}var v={},b="recordConfig",x=null;v.toResolution=function(e){return{width:e.width,height:e.height}},v.scaleResolution=function(e,t){var n=Math.min(t.height/e.height,t.width/e.width,1);return{width:Math.floor(e.width*n),height:Math.floor(e.height*n)}},v.getResolutionLimit=function(e,t){return e.limitResolution?"tab"===e.captureSource?v.scaleResolution(i.toPhysicalResolution(t),e.maxResolution):e.maxResolution:null};var S=a.wrap(regeneratorRuntime.mark(function A(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(x){e.next=4;break}return e.next=3,c.cpu.getInfo();case 3:x=e.sent.numOfProcessors;case 4:return e.abrupt("return",x);case 5:case"end":return e.stop()}},A,this)})),E=a.wrap(regeneratorRuntime.mark(function R(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S();case 2:if(e=t.sent,!(e>=4)){t.next=7;break}return t.abrupt("return",{width:1920,height:1080});case 7:return t.abrupt("return",{width:1280,height:720});case 8:case"end":return t.stop()}},R,this)})),C=a.wrap(regeneratorRuntime.mark(function k(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=h(),e.t0){e.next=6;break}return e.next=4,S();case 4:e.t1=e.sent,e.t0=e.t1<=4;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}},k,this)}));return v.canCaptureSystemAudio=function(){return l().indexOf("Windows")>=0||p()&&f()>=46},v.getRecentlyConnectedApp=function(){return r.getRecent().then(function(e){return e?o.getAppInfo(e):null})},v.clearRecentlyConnectedApp=function(){return r.clearRecent()},v.setRecordConfig=function(t){return e.local.setSingle(b,t)},v.isPreviewSupported=a.wrap(regeneratorRuntime.mark(function $(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("tab"!==e){n.next=2;break}return n.abrupt("return",!1);case 2:if("cam"!==e&&d()){n.next=4;break}return n.abrupt("return",!0);case 4:return n.next=6,s.getCurrent();case 6:return t=n.sent,n.abrupt("return","fullscreen"!==t.state);case 8:case"end":return n.stop()}},$,this)})),v.getRecordConfig=a.wrap(regeneratorRuntime.mark(function P(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.local.getSingle(b,{});case 2:if(t=n.sent,!angular.isDefined(t.limitResolution)){n.next=7;break}n.t0=t.limitResolution,n.next=10;break;case 7:return n.next=9,C();case 9:n.t0=n.sent;case 10:if(t.limitResolution=n.t0,!t.maxResolution){n.next=15;break}n.t1=t.maxResolution,n.next=18;break;case 15:return n.next=17,E();case 17:n.t1=n.sent;case 18:if(t.maxResolution=n.t1,t.audio=angular.isObject(t.audio)?t.audio:{mic:!0,system:!1},t.draw=t.draw||{showToolbox:!0,tool:"pointer"},t.embedWebcam=t.embedWebcam||!1,t.camPosition=t.camPosition||"bottomRight",t.captureSource=t.captureSource||"desktop",t.targetFPS=t.targetFPS||g(),t.startDelay=angular.isDefined(t.startDelay)?t.startDelay:u.IS_E2E?0:3,"desktop"!==t.captureSource||v.canCaptureSystemAudio()||(t.audio.system=!1),n.t2=t.showPreview,!n.t2){n.next=32;break}return n.next=31,v.isPreviewSupported(t.captureSource);case 31:n.t2=!n.sent;case 32:if(!n.t2){n.next=34;break}t.showPreview=!1;case 34:return n.next=36,y(t);case 36:return t=n.sent,n.next=39,w(t);case 39:return t=n.sent,n.abrupt("return",t);case 41:case"end":return n.stop()}},P,this)})),v}]),angular.module("castifyExt.recorder",["castifyExt.backgroundTool","castifyExt.optionalPermissions","w69b.spawn"]).factory("recorder",["backgroundTool","optionalPermissions","spawn","$q",function(e,t,n,r){var o=e.portHelper("recorder",!1),i=r.defer(),a={};a.info={},a.connectedPromise=i.promise;var c={};return c.stateUpdate=function(e){angular.copy(e,a.info),i&&(i.resolve(),i=null)},o.installHandlers(c),a.getState=function(){return a.connectedPromise.then(function(){return a.info})},a.start=n.wrap(regeneratorRuntime.mark(function u(e){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("tab"!==e.captureSource){i.next=6;break}return i.next=3,t.requestTabPermissions(e);case 3:if(n=i.sent){i.next=6;break}return i.abrupt("return",r.reject("tab_permissions"));case 6:return i.abrupt("return",o.postMessage("start",e));case 7:case"end":return i.stop()}},u,this)})),a.stop=function(){o.postMessage("stop")},a.pause=function(){o.postMessage("pause")},a.resume=function(){o.postMessage("resume")},a.replaceStream=function(e){o.postMessage("replaceStream",e)},a.cancelPendingStart=function(){o.postMessage("cancelPendingStart")},a.showPreview=function(e){o.postMessage("showPreview",e)},o.getPort(),a}]),angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(e,t,n){function r(r,o,i,a){function c(){return e.get(r).then(function(e){return l=e})}function u(){return t.get(l.windowId).then(function(e){if("normal"!==e.state&&a===!1)return n.reject();var r=e.width-l.width,c=e.height-l.height,u=o+r+f,s=i+c+p;return t.update(l.windowId,{width:u,height:s,state:"normal"})})}function s(e){return e.width!=o||e.height!=i?(f+=o-e.width,p+=i-e.height,u().then(c)):e}var l,f=0,p=0;return c().then(u).then(c).then(s).then(s)["catch"](function(){return l})}return r}]),angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","w69b.chromeStorage","w69b.spawn","castifyExt.userAccount","castifyExt.optionalPermissions"]).factory("setupService",["webrtc","spawn","chromeStorage","$q","appOptions","$log","optionalPermissions","userAccount",function(e,t,n,r,o,i,a,c){function u(){return t(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.sync.getSingle(f,!1),e.next=3,o.loadedPromise;case 3:if(e.t0=o.isSetByEnterprisePolicy("driveSync"),e.t0){e.next=8;break}return e.next=7,t;case 7:e.t0=e.sent;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}},e,this)}))}function s(){return t(regeneratorRuntime.mark(function n(){var t,r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.hasVideoAccess(),r=e.hasMicrophone(),o=e.hasAudioAccess(),n.next=5,t;case 5:if(n.t0=n.sent,n.t0){n.next=15;break}return n.next=9,r;case 9:if(n.t1=!n.sent,n.t1){n.next=14;break}return n.next=13,o;case 13:n.t1=n.sent;case 14:n.t0=n.t1;case 15:return n.abrupt("return",n.t0);case 16:case"end":return n.stop()}},n,this)}))}var l={},f="setupService:storageDecided",p="setupService:welcomeShown";return l.getDriveSyncEnabled=t.wrap(regeneratorRuntime.mark(function d(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadedPromise;case 2:return e.abrupt("return",o.values.driveSync);case 3:case"end":return e.stop()}},d,this)})),l.setStorageDecided=function(e){return n.sync.setSingle(f,e)},l.setWelcomeShown=function(e){return n.sync.setSingle(p,e)},l.getWelcomeShown=function(){return n.sync.getSingle(p,!1)},l.getSetupState=function(){return t(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.hasLiteTabPermissions();case 2:return e.t0=e.sent,e.next=5,s();case 5:return e.t1=e.sent,e.next=8,c.getAccount();case 8:return e.t2=!!e.sent.user,e.next=11,u();case 11:return e.t3=e.sent,e.next=14,l.getDriveSyncEnabled();case 14:return e.t4=e.sent,e.abrupt("return",{tab:e.t0,cam:e.t1,signIn:e.t2,storage:e.t3,driveSync:e.t4});case 16:case"end":return e.stop()}},e,this)}))},l.isComplete=function(){return t(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.getSetupState();case 2:return t=e.sent,i.debug("setupService.isComplete state",t),e.abrupt("return",t.cam&&t.storage&&(!t.driveSync||t.signIn));case 5:case"end":return e.stop()}},e,this)}))},l}]),angular.module("castifyExt.upgradeHelper",["castifyExt.userAccount","w69b.chromeTabs"]).factory("upgradeHelper",["chromeTabs","userAccount","$rootScope",function(e,t,n){function r(){function e(){t.getAccount().then(function(e){i=e,o.license=e.license})}n.$on("event:userAccountChanged",e),e()}var o={};o.openBuy=function(t,n){var r="https://www.screencastify.com/buy?utm_source=app&utm_source=app&utm_campaign="+t;n&&(r+="&utm_content="+n),e.create({url:r})};var i=null;return o.license={},r(),o.getNumRecordingsMonth=function(){return i.numRecordingsMonth},o.getMaxRecordingsMonth=function(){return i.license.maxNumRecordings},o.isPaid=function(){return i&&i.license.isPaid},o.hasEditorAlphaAccess=function(){return i&&i.license.editorAlpha},o.isSignedIn=function(){return i&&!!i.user},o.signIn=function(){return t.signIn()},o}]),angular.module("castifyExt.ui.recordOptions",["ngMaterial","castifyExt.recordTool","castifyExt.appOptions","castifyExt.resizeTab","castifyExt.ui.pixelResolution","castifyExt.ui.selectDropdown","castifyExt.ui.deviceChooser","castifyExt.ui.connectAppChooser","castifyExt.ui.autoShareDialog","castifyExt.connect.appRegistry","castifyExt.hdpiTool","w69b.ui.focus"]).controller("RecordOptionsCtrl",["$scope","recordTool","chromeTabs","webrtc","$mdDialog","appRegistry","$q","$mdSidenav","$mdToast","appOptions","hdpiTool",function(e,t,n,r,o,i,a,c,u,s,l){function f(){e.autoShareApp&&i.getAppInfo(e.autoShareApp.id).then(function(t){e.autoShareApp&&e.autoShareApp.id===t.id&&(e.autoShareApp=t)})}function p(){s.values.showDrawingToolsHint&&u.show(u.simple().content("Mouse cursor and drawing tools are only available on regular web sites with tab recording.").action("Got it").hideDelay(4e3)).then(function(e){"ok"===e&&(s.values.showDrawingToolsHint=!1,s.save())})}function d(e){return(e&&e.startsWith("https://")||e.startsWith("http://")||e.startsWith("file://"))&&!e.startsWith("https://chrome.google.com/webstore/")}function h(){var n=["tab","desktop","cam"];e.$watch("recordConfig.captureSource",function(t){e.captureTabIdx=n.indexOf(t)}),e.$watch("captureTabIdx",function(t){e.recordConfig.captureSource=n[t]}),e.$watch("recordConfig.embedWebcam",function(t){t&&e.hasMic&&(e.recordConfig.audio.mic=!0)}),s.values.showDrawingToolsHint&&e.$watchGroup(["recordConfig.captureSource","tab.url"],function(e){var t=e[0],n=e[1];n&&"tab"===t&&!d(n)?p():u.cancel()}),e.$watch("recordConfig.captureSource",function(n){t.isPreviewSupported(n).then(function(t){return e.isPreviewSupported=t}),"desktop"===n?(e.systemAudioLabel="System Audio",e.canCaptureSystemAudio=t.canCaptureSystemAudio(),e.canEmbedCam="webrtc"!==s.values.encoder):"tab"===n?(e.systemAudioLabel="Tab Audio",e.canCaptureSystemAudio=!0,e.canEmbedCam=!0):(e.canCaptureSystemAudio=!1,e.canEmbedCam=!0)}),e.$watch("[tab.width, tab.height, recordConfig.maxResolution, recordConfig.captureSource, recordConfig.limitResolution]",function(){var n=e.recordConfig;n&&e.tab&&(e.recordingResolution=t.getResolutionLimit(n,e.tab),e.recordingResolution||(e.recordingResolution=l.toPhysicalResolution("tab"==n.captureSource?e.tab:l.getScreenCssResolution())))},!0),e.$watch("[recordConfig, autoShareApp, isPreviewSupported]",function(){var t=e.recordConfig;if(t){var n=angular.copy(t);e.canCaptureSystemAudio||(n.audio.system=!1),e.isPreviewSupported||(n.showPreview=!1),n.autoShareApp=e.autoShareApp,e.config=angular.copy(n,e.config)}},!0)}function m(){n.getActiveTab().then(function(t){e.tab=t})}a.all({access:r.hasVideoAccess(),present:r.hasCamera()}).then(function(t){e.hasCam=t.access,e.camSetupRequired=t.present&&!t.access}),a.all({access:r.hasAudioAccess(),present:r.hasMicrophone()}).then(function(t){e.hasMic=t.access,e.micSetupRequired=t.present&&!t.access}),t.getRecordConfig().then(function(n){e.recordConfig=n,e.$watch("recordConfig",function(e,n){angular.equals(e,n)||t.setRecordConfig(e)},!0),e.autoShareApp=n.autoShareApp,h(),f()}),e.toggleAdvanced=function(){c("advanced-video").toggle()},e.systemAudioLabel="Tab Audio",e.confirmApp=function(t,n){if(!t.shareUrl)return a.reject();t={title:t.title,id:t.id,isPaid:t.isPaid};var r=e.$new(!0);r.app=t,r.isRecent=n;var i=o.show({scope:r,controller:"AutoShareDialogCtrl",templateUrl:"components/castifyExt/ui/auto-share-dialog/auto-share-dialog.html"});return i.then(function(n){n&&(e.autoShareApp=t,n.remember?e.recordConfig.autoShareApp=t:delete e.recordConfig.autoShareApp)}),i},e.clearApp=function(){e.autoShareApp=null,delete e.recordConfig.autoShareApp},t.getRecentlyConnectedApp().then(function(n){n&&n.autoSharePrompt&&e.confirmApp(n,!0)["finally"](t.clearRecentlyConnectedApp)}),m()}]).directive("cfRecordOptions",function(){return{restrict:"E",templateUrl:"components/castifyExt/ui/record-options/record-options.html",replace:!0,controller:"RecordOptionsCtrl",scope:{config:"="}}}).directive("cfMicOption",function(){return{restrict:"E",scope:{audio:"="},templateUrl:"components/castifyExt/ui/record-options/mic-option.html"}}).component("cfAdvancedVideoOptions",{bindings:{config:"=",tab:"="},templateUrl:"components/castifyExt/ui/record-options/advanced-video-options.html",controller:["$scope","resizeTab","$mdSidenav","hdpiTool",function(e,t,n,r){function o(e){var t=r.getScreenCssResolution();return e&&(t=r.toPhysicalResolution(t)),[{name:"1080p",width:1920,height:1080},{name:"720p",width:1280,height:720},{name:"480p",width:848,height:480},{name:"360p",width:640,height:360},{name:"240p",width:426,height:240}].filter(function(e){return e.width<t.width||e.height<t.height})}function i(e,n){t(a.tab.id,e,n).then(function(e){a.tab=e})}var a=this;e.resolutions=o(!0),e.tabResolutions=o(!1),e.frameRates=[{value:60,help:"enough"},{value:30,help:"smooth video recording"},{value:10,help:"ok for most stuff"},{value:5,help:"for slow hardware"},{value:1,help:"for very slow hardware"}],e.$watch("!$ctrl.config.draw.showToolbox && hidePointer",function(e){a.config&&a.config.draw&&(e?a.config.draw.tool=null:a.config.draw.tool="pointer")}),e.$watch("!!$ctrl.config.draw.tool",function(t){e.hidePointer=!t});var c=3;a.onCountdownEnableChange=function(){a.enableCountdown?a.config.startDelay=c:(c=a.config.startDelay,a.config.startDelay=0)},e.$watch("!!$ctrl.config.startDelay",function(e){a.enableCountdown=e>0}),e.close=function(){n("advanced-video").close()},e.resizeTab=function(e){i(e.width,e.height)}}]}).directive("cfEmbedOption",function(){return{restrict:"E",scope:{config:"="},templateUrl:"components/castifyExt/ui/record-options/embed-option.html",link:function(e){e.camPositions=[{value:"topLeft",name:"top-left"},{value:"topRight",name:"top-right"},{value:"bottomLeft",name:"bottom-left"},{value:"bottomRight",name:"bottom-right"}]}}}),angular.module("castifyExt.ui.recorder",["w69b.chromeTabs","w69b.timeutil","w69b.ui.bytesFilter","castifyExt.recorder","castifyExt.ui.recordOptions","castifyExt.ui.micLevel","castifyExt.ui.licenseHint","castifyExt.ui.searchHelp","castifyExt.optionalPermissions"]).component("cfRecorder",{templateUrl:"components/castifyExt/ui/recorder/recorder.html",controller:["$scope","recorder","$state",function(e,t,n){e.showstartError=!1,e.diskQuota=null,e.recorder=t.info,e.cancelPendingStart=function(){t.cancelPendingStart()},e.$watch("recorder.state",function(e){e=e||"loading","paused"===e&&(e="recording"),n.go("recorder."+e)})}]}).component("cfRecorderLoading",{templateUrl:"components/castifyExt/ui/recorder/recorder-loading.html"}).component("cfRecorderRecording",{templateUrl:"components/castifyExt/ui/recorder/recorder-recording.html",controller:["$scope","recorder","chromeTabs",function(e,t,n){e.recorder=t.info,e.onShowPreview=function(){t.showPreview(t.info.previewShown)},n.getActiveTab().then(function(t){e.tab=t})}]}).component("cfRecorderInactive",{controller:["$scope","$mdToast","optionalPermissions","recorder","castifyConfig","$log","$window",function(e,t,n,r,o,i,a){function c(){i.debug("recorder.start(): tab permissions denied"),t.show(t.simple().content("Hint: desktop recording works without these permissions.").action("Learn More").hideDelay(4e3))}e.record=function(){r.start(e.recordConfig).then(function(){var t=e.recordConfig.captureSource;"tab"!==t&&"desktop"!==t||o.IS_E2E||a.close()})["catch"](function(e){"tab_permissions"===e&&c()})},e.needsTabSetup=!1,n.hasLiteTabPermissions().then(function(t){t||e.$watch('recordConfig.captureSource == "tab"',function(t){e.needsTabSetup=t})});var u={tab:"Record Tab",desktop:"Record Desktop",cam:"Record Webcam"};e.$watch("recordConfig.captureSource",function(t){e.startRecordingLabel=u[t]}),e.setupTabPermissions=function(){n.requestTabPermissions(e.recordConfig).then(function(e){e?t.show(t.simple().content("Tab recording is now ready to be used.").hideDelay(2e3)).then(function(){a.close()}):c()})}}],templateUrl:"components/castifyExt/ui/recorder/recorder-inactive.html",bindings:{recordConfig:"<"}}).component("cfCaptureSourceInfo",{templateUrl:"components/castifyExt/ui/recorder/capture-source-info.html",bindings:{tab:"<",recorder:"<"},controller:["chromeTabs",function(e){var t=this;this.showTab=function(){e.update(t.recorder.config.tabId,{active:!0})}}]}).component("cfRecordCtrlButtons",{restrict:"E",templateUrl:"components/castifyExt/ui/recorder/record-ctrl-buttons.html",bindings:{tab:"<"},controller:["recorder","$scope","$window","castifyConfig",function(e,t,n,r){t.recorder=e.info;var o=this;this.replaceStream=function(){e.replaceStream({tabId:o.tab.id,windowId:o.tab.windowId,tabTitle:o.tab.title})},this.canReplaceTab=function(){var t=e.info.config;return t.tabId!=o.tab.id&&"tab"==t.captureSource&&"webrtc"!==t.codec},this.stop=function(){e.stop(),r.IS_E2E||n.close()},this.pause=function(){e.pause()},this.resume=function(){e.resume()}}]}).directive("cfMicLevelAndSlider",function(){return{restrict:"E",scope:{sourceId:"=?"},templateUrl:"components/castifyExt/ui/recorder/mic-level-and-slider.html",replace:!0}}).directive("cfMicLevelIconMenu",function(){return{restrict:"E",scope:{sourceId:"=?",noSlider:"@"},templateUrl:"components/castifyExt/ui/recorder/mic-level-icon-menu.html"}}),angular.module("castifyExt.ui.pixelResolution",[]).directive("pixelResolution",function(){return{template:'<span ng-show="resolution.width || resolution.height">{{resolution.width}}&#215;{{resolution.height}}</span>',restrict:"A",scope:{resolution:"=pixelResolution"}}}),angular.module("castifyExt.ui.openInAppTab",["w69b.chromeTabs","w69b.chromeWindows"]).service("openInAppTab",["chromeTabs","chromeRuntime","chromeWindows","$q",function(e,t,n,r){return function(r){var o="chrome-extension://"+t.id+"/app.html";return 0===r.lastIndexOf("#",0)&&(r=o+r),e.create({active:!0,url:r}).then(function(e){n.update(e.windowId,{focused:!0})})}}]).directive("openInAppTab",["$window","openInAppTab",function(e,t){return{restrict:"A",link:function(n,r,o){r.bind("click",function(n){var r=angular.element(n.target),i=o.href||r.attr("href");i&&(n.preventDefault(),t(i).then(function(){e.close()}))})}}}]),angular.module("castifyExt.ui.licenseHint",["castifyExt.ui.upgradeButton","castifyExt.upgradeHelper"]).component("cfLicenseHint",{templateUrl:"components/castifyExt/ui/license-hint/license-hint.html",controller:["upgradeHelper","$mdToast","$scope",function(e,t,n){n.upgradeHelper=e,n.showHelp=function(){var n="Recording length is limited to 10 minutes. ";if(e.license.branding&&(n+="A Screencastify logo is embedded in the top-right corner. "),e.license.limitNumRecordings){var r=Math.max(0,e.getMaxRecordingsMonth()-e.getNumRecordingsMonth());n+="You have "+r+" out \n          of "+e.getMaxRecordingsMonth()+" free recordings / \n          month left."}t.show(t.simple({hideDelay:5e3}).content(n))}}]}),angular.module("castifyExt.ui.surveyFlow",["ngMaterial","ui.router","w69b.spawn","w69b.chromeAnalytics","w69b.chromeStorage","castifyExt.userAccount","castifyExt.ui.survey","castifyExt.recordTool","castifyExt.recorder","castifyExt.setupService","castifyExt.ui.openInAppTab"]).component("cfSurveyFlow",{templateUrl:"components/castifyExt/ui/survey-flow/survey-flow.html",controller:["$state","$log","surveyFlowService","spawn","openInAppTab",function(e,t,n,r,o){var i=this;i.next=r.wrap(regeneratorRuntime.mark(function a(){var r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.getNextStep();case 2:r=i.sent,t.debug("surveyFlow.next",r),"setup"===r?o("#/setup").then(function(){window.close()}):r?e.go("surveyFlow."+r):e.go("recorder");case 5:case"end":return i.stop()}},a,this)})),i.cancel=function(){t.debug("surveyFlow.cancel"),e.go("recorder")},i.confirmTos=r.wrap(regeneratorRuntime.mark(function c(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.saveTosConfirmed();case 2:i.next();case 3:case"end":return e.stop()}},c,this)})),i.$onInit=function(){i.next()}}]}).component("cfSignInRequest",{templateUrl:"components/castifyExt/ui/survey-flow/sign-in-request.html",require:{flowCtrl:"^^cfSurveyFlow"},controller:["$window","userAccount","analytics",function(e,t,n){var r=this;this.signIn=function(){t.signIn(),e.close()},n.trackEvent("sign_in_dialog","show"),this.cancel=function(){n.trackEvent("sign_in_dialog","cancel"),r.flowCtrl.cancel()}}]}).component("cfTosUpdate",{templateUrl:"components/castifyExt/ui/survey-flow/tos-update.html",require:{flowCtrl:"^^cfSurveyFlow"}}).factory("surveyFlowService",["$mdToast","userAccount","chromeStorage","spawn","$log","analytics","castifyConfig","recordTool","recorder","$q","setupService",function(e,t,n,r,o,i,a,c,u,s,l){var f="signInHitCnt",p=3,d="tos_confirmed",h=!1,m=10,g=r.wrap(regeneratorRuntime.mark(function v(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.user){n.next=3;break}return n.abrupt("return",!1);case 3:if(!h){n.next=6;break}return h=!1,n.abrupt("return",!0);case 6:if(!(t.survey&&Object.keys(t.survey).length>0)){n.next=8;break}return n.abrupt("return",!1);case 8:return n.abrupt("return",!0);case 9:case"end":return n.stop()}},v,this)})),y=r.wrap(regeneratorRuntime.mark(function b(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.local.getSingle(d,!1);case 2:return e=t.sent,t.abrupt("return",!e);case 4:case"end":return t.stop()}},b,this)})),w={};return w.saveTosConfirmed=function(){
return n.local.setSingle(d,!0)},w.getNextStep=r.wrap(regeneratorRuntime.mark(function x(){var e,r,i,d,h,w,v,b,S;return regeneratorRuntime.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!a.IS_E2E){x.next=2;break}return x.abrupt("return",null);case 2:return x.next=4,s.all([t.getAccount(),c.getRecordConfig(),u.getState(),l.isComplete()]);case 4:if(e=x.sent,r=_slicedToArray(e,4),i=r[0],d=r[1],h=r[2],w=r[3],"inactive"===h.state){x.next=12;break}return x.abrupt("return",null);case 12:if(v=d.autoShareApp&&d.autoShareApp.isPaid,b=null,w){x.next=18;break}b="setup",x.next=45;break;case 18:return x.next=20,y();case 20:if(!x.sent){x.next=24;break}b="tos",x.next=45;break;case 24:if(x.t0=!v,!x.t0){x.next=29;break}return x.next=28,g(i);case 28:x.t0=x.sent;case 29:if(!x.t0){x.next=33;break}b="survey",x.next=45;break;case 33:if(v||i.user||i.license.isPaid){x.next=44;break}return x.next=36,n.local.getSingle(f,p);case 36:return S=x.sent,S++,o.debug("signInDialog.cnt",S),S>=p&&(b="signIn",S=0),x.next=42,n.local.setSingle(f,S);case 42:x.next=45;break;case 44:!v&&i.license.limitNumRecordings&&i.numRecordingsMonth>=i.license.maxNumRecordings?b="monthlyLimitReached":!v&&i.license.limitNumRecordings&&i.numRecordingsMonth+m>=i.license.maxNumRecordings&&(b="monthlyLimitApproaching");case 45:return x.abrupt("return",b);case 46:case"end":return x.stop()}},x,this)})),w}]),angular.module("castifyExt.ui.survey",["w69b.spawn","w69b.chromeAnalytics","castifyExt.ui.quizQuestions","castifyExt.userAccount"]).component("cfSurveyFlowSurvey",{templateUrl:"components/castifyExt/ui/survey-flow/survey-step.html",require:{flowCtrl:"?^^cfSurveyFlow"},controller:["analytics",function(e){var t=this;t.cancel=function(){e.trackEvent("survey_dialog","cancel"),t.flowCtrl.cancel()}}]}).component("cfSurveyNotice",{templateUrl:"components/castifyExt/ui/survey-flow/survey-notice.html",bindings:{studentType:"=",onDone:"&"}}).component("cfSurvey",{templateUrl:"components/castifyExt/ui/survey-flow/survey.html",bindings:{onCancel:"&",onDone:"&",onAnswered:"&"},controller:["$http","castifyConfig","spawn","analytics","userAccount","$log",function(e,t,n,r,o,i){function a(){return e.get(s).then(function(e){return e.data})}function c(e){var t=o.postUpdate({survey:e});return angular.forEach(e,function(e,t){r.trackEvent("survey_answered",t,e)}),t}function u(e){l.showNotice=!0,l.studentType=e.student_type}var s=t.API_URL+"/survey_questions",l=this;l.$onInit=n.wrap(regeneratorRuntime.mark(function f(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l.loading=!0,t.next=3,a()["catch"](function(){return null});case 3:e=t.sent,l.quizConfig=e,l.loading=!1,e&&e.answers?r.trackEvent("survey_dialog","show"):(i.debug("surveyFlowService: no questions found"),l.cancel());case 7:case"end":return t.stop()}},f,this)})),l.saveAnswers=n.wrap(regeneratorRuntime.mark(function p(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.trackEvent("survey_dialog","success"),t.prev=1,l.loading=!0,t.next=5,c(e);case 5:u(e),l.onAnswered(e),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),i.warn("cfSurvey: failed to store survey answers",t.t0),l.cancel();case 13:l.loading=!1;case 14:case"end":return t.stop()}},p,this,[[1,9]])})),l.cancel=function(){l.onCancel()}}]}),angular.module("castifyExt.ui.quizQuestions",["ngMaterial"]).component("cfQuizQuestions",{bindings:{config:"<",onDone:"&"},templateUrl:"components/castifyExt/ui/quiz-questions/quiz-questions.html",controller:function(){function e(e){t.node=e}var t=this,n={},r=[];t.back=function(){var t=r.pop();delete n[t.key],e(t)},t.canGoBack=function(){return r.length>0},t.selectAnswer=function(o){r.push(t.node),n[t.node.key]=o.value,o.next?e(o.next):t.onDone({answers:n})},t.$onChanges=function(){e(t.config)}}}),angular.module("castifyExt.ui.selectDropdown",[]).directive("cfSelectDropdown",function(){return{restrict:"E",replace:!0,templateUrl:"components/castifyExt/ui/select-dropdown/select-dropdown.html",scope:{ngModel:"=",options:"=",label:"@"}}}),angular.module("castifyExt.ui.deviceChooser",["w69b.webrtc","castifyExt.ui.selectDropdown"]).directive("cfDeviceChooser",["webrtc",function(e){return{restrict:"E",scope:{ngModel:"=",label:"@"},templateUrl:"components/castifyExt/ui/device-chooser/device-chooser.html",link:function(t,n,r){t.sources=[],e.getSourcesByKind(r.inputType).then(function(e){t.sources=e.map(function(e){return{name:e.label,value:e.id}})})}}}]),angular.module("castifyExt.ui.searchHelp",["castifyExt.helpCenter"]).directive("cfSearchHelp",["chromeTabs","helpCenter",function(e,t){var n="https://screencastify.helpscoutdocs.com";return{link:function(r,o,i){o.bind("click",function(r){var o=n,a=i.cfSearchHelp;r.preventDefault(),a&&t.hasHelpFor(a)?t.openHelp(a):(a&&(o=n+"/search?query="+encodeURIComponent(a)),e.create({url:o}))})}}}]),angular.module("castifyExt.ui.autoShareDialog",[]).controller("AutoShareDialogCtrl",["$scope","$mdDialog",function(e,t){e.opt={remember:!0},e.$mdDialog=t,e.confirm=function(){t.hide({remember:e.opt.remember})}}]),angular.module("castifyExt.ui.themeConfig",["ngMaterial"]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("orange",{"default":"800","hue-1":"300","hue-2":"600","hue-3":"900"}).accentPalette("pink")}]).config(["$mdIconProvider",function(e){e.defaultIconSet("gen/icons.svg")}]),angular.module("castifyExt.ui.loadingOverlay",[]).directive("cfLoadingBackdrop",function(){return{restrict:"E",template:'<md-progress-circular md-mode="indeterminate"></md-progress-circular>'}}).directive("cfLoadingOverlay",["$compile",function(e){return{restrict:"A",link:function(t,n,r){var o=null;t.$watch(r.cfLoadingOverlay,function(r){r?(o=e("<cf-loading-backdrop></cf-loading-backdrop>")(t),n.append(o)):o&&(o.remove(),o=null)})}}}]),angular.module("castifyExt.ui.sidenav",["castifyExt.userAccount","castifyExt.upgradeHelper","castifyExt.userAccount","castifyExt.ui.openInAppTab","w69b.chromeTabs"]).directive("cfSidenav",["connectedApps","$location","upgradeHelper","$window","$mdSidenav","openInAppTab","chromeTabs","userAccount",function(e,t,n,r,o,i,a,c){return{restrict:"E",scope:{isOpen:"=?"},templateUrl:"components/castifyExt/ui/sidenav/sidenav.html",link:function(e,u,s){function l(){c.getAccount().then(function(t){e.userAccount=t})}function f(){s.hasOwnProperty("popupMode")&&(e.popupMode=!0),l(),e.upgradeHelper=n}e.$root.$on("event:userAccountChanged",l),e.signIn=c.signIn.bind(c),e.signOut=c.signOut.bind(c),e.open=function(n){e.popupMode?i("#"+n).then(function(){r.close()}):(t.path(n),o("main-menu").close())},e.closeMenu=function(){e.isOpen=!1};var p={gplus:"https://google.com/+ScreencastifyChrome",account:"https://www.screencastify.com/user/licenses"};e.openExternal=function(e){a.create({url:p[e]})},f()}}}]),angular.module("castifyExt.ui.topnav",["ngMaterial"]).component("cfTopnav",{transclude:!0,bindings:{popupMode:"@",parentState:"@",onGoUp:"&?"},templateUrl:"components/castifyExt/ui/topnav/topnav.html",controller:["$scope","$mdSidenav","$state",function(e,t,n){var r=this;r.$onChanges=function(){r.popupMode=angular.isDefined(r.popupMode),r.showMenu=!(r.parentState||r.onGoUp)},r.openMenu=function(){r.parentState?n.go(r.parentState):r.onGoUp?r.onGoUp():r.popupMode?e.$root.isAppMenuOpen=!0:t("main-menu").toggle()}}]}),angular.module("castifyExt.ui.upgradeButton",["castifyExt.upgradeHelper","castifyExt.userAccount"]).component("cfUpgradeButton",{template:'<md-button ng-click="$ctrl.action()" class="md-primary"\n    ng-show="!upgradeHelper.isPaid()">{{text}}</md-button>\n    <ng-transclude ng-show="upgradeHelper.isPaid()"></ng-transclude>',bindings:{content:"@",campaign:"@"},transclude:!0,controller:["$scope","upgradeHelper","userAccount",function(e,t,n){var r=this;e.upgradeHelper=t,e.$watch(t.isSignedIn,function(t){t?e.text="Upgrade":e.text="Sign In"}),r.action=function(){t.isSignedIn()?t.openBuy(r.campaign,r.content):n.signIn()}}]}),angular.module("castifyExt.ui.monthlyLimit",["castifyExt.upgradeHelper"]).component("cfMonthlyLimitReached",{templateUrl:"components/castifyExt/ui/monthly-limit/monthly-limit-reached.html",controller:["upgradeHelper",function(e){var t=this;t.$onInit=function(){t.upgradeHelper=e}}],require:{flowCtrl:"^^cfSurveyFlow"}}).component("cfMonthlyLimitApproaching",{templateUrl:"components/castifyExt/ui/monthly-limit/monthly-limit-approaching.html",controller:["upgradeHelper",function(e){var t=this;t.$onInit=function(){t.upgradeHelper=e}}],require:{flowCtrl:"^^cfSurveyFlow"}}),angular.module("castifyExt.uploader",["castifyExt.backgroundTool"]).factory("uploader",["backgroundTool",function(e){var t=e.portHelper("uploader"),n={};n.state={};var r={};return r.stateUpdate=function(e){angular.copy(e,n.state)},t.installHandlers(r),n.upload=function(e){t.postMessage("upload",e)},n.getFileState=function(e){return n.state[e]},n.getTargetState=function(e,t){var r=n.getFileState(e);return r?r[t]:null},n.isQueuedOrActive=function(e,t){var r=n.getTargetState(e,t);return r&&("uploading"===r.state||"queued"===r.state)},n}]),angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){var n="event:";e.onMessage.addListener(function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf(n,0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()})}]),angular.module("castifyExt.enterprisePolicy",["w69b.chromeStorage"]).provider("enterprisePolicy",function(){var e={};this.setOverride=function(t){e=t},this.$get=["chromeStorage","$rootScope",function(t,n){var r={},o=!1,i={options:{}};angular.extend(i,e);var a=["disableSharing","disableSaveToDisk","options"];return a.forEach(function(e){Object.defineProperty(r,e,{get:function(){return i[e]}})}),r.loadedPromise=t.managed.get(a).then(function(t){angular.extend(i,t,e),o=!0}),r.isLoaded=function(){return o},r.has=function(e){return i.hasOwnProperty(e)},r.get=function(e){return i[e]},t.onChanged.addListener(function(e,t){"managed"===t&&(angular.forEach(e,function(e,t){i[t]=e.newValue}),n.$$phase||n.$digest())}),r}]}),angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.helpCenterConfig","castifyExt.appOptions","castifyExt.userAccount","castifyExt.deployConfig"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider","$locationProvider",function(e,t,n,r){n.setTrackingId("UA-23874345-14"),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var o=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(o),e.imgSrcSanitizationWhitelist(o),r.hashPrefix("")}]).run(["$rootScope","analytics","chromeRuntime","appOptions","$injector","userAccount",function(e,t,n,r,o,i){function a(){return i.getAccount().then(function(e){var o="unknown";if(e.license.isPaid)o="paid";else{if(!e.license.isTester)return o="trial";o="tester"}t.tracker.set("dimension1",o),t.tracker.set("dimension2",n.getManifest().version),e.user?(t.tracker.set("userId",e.user.analyticsUid),t.tracker.set("dimension4",e.user.analyticsUid),t.setEnabled(r.values.enableAnalytics&&e.user.analyticsEnabled!==!1)):t.setEnabled(r.values.enableAnalytics)})}var c=o.has("$transitions")?o.get("$transitions"):null,u=r.loadedPromise.then(a);c&&c.onSuccess({},function(e){var n=e.targetState().state(),r=n.analyticsView||n.pageTitle;r&&u.then(function(){t.tracker.sendAppView(r)})}),e.$on("event:userAccountChanged",a)}]).factory("castifyConfig",["deployConfig",function(e){return{API_URL:e.apiUrl,IS_E2E:window.localStorage.e2e}}]),angular.module("castifyExt.deployConfig",[]).provider("deployConfig",function(){var e={apiUrl:"https://www.screencastify.com/api",clientId:"242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com",scopes:chrome.runtime.getManifest().oauth2.scopes,redirectUri:"https://www.screencastify.com/oauth2postback",editorOpenUri:"https://editor.screencastify.com/open/drive"};return _extends({},e,{$get:function(){return e}})}),angular.module("castifyExt.helpCenter",["w69b.chromeTabs"]).factory("helpCenter",["chromeTabs",function(e){var t={};return t.tagUrls={},t.registerUrl=function(e,n){t.tagUrls[e]=n},t.hasHelpFor=function(e){return t.tagUrls.hasOwnProperty(e)},t.openHelp=function(n){var r=t.tagUrls[n];if(!r)throw new Error("No help url registered for "+n);e.create({url:r})},t.setNotifyHelp=function(e,n){e.onButtonClicked=e.onClicked=function(){t.openHelp(n),e.clear()}},t}]),angular.module("castifyExt.userAccount",["castifyExt.simpleBgServiceConsumer","castifyExt.chromeEventPublisher"]).factory("userAccount",["simpleBgServiceConsumer",function(e){return e("userAccount",["getAccount","signIn","postUpdate","signOut"])}]),angular.module("castifyExt.helpCenterConfig",["castifyExt.helpCenter"]).run(["helpCenter",function(e){e.registerUrl("load_nacl","https://screencastify.helpscoutdocs.com/article/33-failed-to-load-nacl-module"),e.registerUrl("disk_space","https://screencastify.helpscoutdocs.com/article/32-out-of-disk-space"),e.registerUrl("drive_apps","https://screencastify.helpscoutdocs.com/article/34-enabling-drive-on-google-apps"),e.registerUrl("start_recording","https://screencastify.helpscoutdocs.com/article/35-failed-to-start-recording"),e.registerUrl("change_account","https://screencastify.helpscoutdocs.com/article/31-how-to-sign-in-with-a-different-account"),e.registerUrl("quotaExceeded","https://screencastify.helpscoutdocs.com/article/20-out-of-space-on-google-drive"),e.registerUrl("youtubeSignupRequired","https://screencastify.helpscoutdocs.com/article/24-youtubesignuprequired-error-when-uploading-to-youtube"),e.registerUrl("no_audio","https://screencastify.helpscoutdocs.com/article/82-failed-to-capture-audio"),e.registerUrl("no_cam","https://screencastify.helpscoutdocs.com/article/83-failed-to-access-your-webcam"),e.registerUrl("trial_monthly_limit","https://www.screencastify.com/buy?utm_source=app&utm_content=notify&utm_campaign=monthly_limit")}]),angular.module("castifyExt.castifyAuth",["castifyExt.simpleBgServiceConsumer"]).factory("castifyAuth",["simpleBgServiceConsumer",function(e){return e("castifyAuth",["launchWebAuthFlow","getRedirectURL","removeCachedAuthToken","getAuthToken","getAccount"])}]).factory("googleauth",["castifyAuth","$q",function(e,t){var n={};return n.loadClient=function(){return t.when()},n.getAuthToken=function(t){e.getAuthToken(angular.isObject(t)?t:{interactive:!!t})},n}]),angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){function n(n,r){function o(e){return e.error?t.reject(e.error):e.data}function i(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(o)}}var a={};return r.forEach(function(e){a[e]=i(e)}),a}return n}]),angular.module("castifyExt.ui.connectAppChooser",["castifyExt.connect.connectedApps","castifyExt.connect.appRegistry"]).directive("cfConnectAppChooser",["connectedApps","appRegistry","$q",function(e,t,n){return{restrict:"E",transclude:!0,require:"?ngModel",templateUrl:"components/castifyExt/ui/connect-app-chooser/connect-app-chooser.html",scope:{onSelected:"&",onDisconnected:"&"},link:function(r,o,i,a){function c(){var e=(r.apps||[]).filter(function(e){return a.$viewValue&&e.id===a.$viewValue.id});return e.length?e[0]:null}function u(e){return r.loading=!0,e["finally"](function(){r.loading=!1}),e}function s(){return e.getConnected({hasShareUrl:!0}).then(t.getApps).then(function(e){r.apps=e,a&&a.$setViewValue(c())})}function l(){e.getConnected({hasShareUrl:!0}).then(function(e){r.hasApps=e.length>0})}function f(){return p?n.when():(p=!0,u(s()))}a&&(a.$render=angular.noop),r.select=function(e){r.selected=e,a&&a.$setViewValue(e),r.onSelected({app:e})},r.showMenu=function(e,t){f().then(function(){t(e)})},r.apps=[],r.loading=!1;var p=!1;l()}}}]),angular.module("castifyExt.connect.connectedApps",["w69b.chromeStorage","w69b.spawn","castifyExt.connect.appRegistry"]).factory("connectedApps",["chromeStorage","spawn","appRegistry","$rootScope",function(e,t,n,r){function o(){return e.sync.getSingle(l,[]).then(function(e){return e.map(function(e){return angular.isObject(e)?e:{id:e,hasShareUrl:!0}})})}function i(t){return e.sync.setSingle(l,t)}function a(){return e.sync.getSingle(f)}function c(t){return e.sync.setSingle(f,t)}function u(e,t){return e.some(function(e){return e.id===t})}var s={},l="connectedAppIds",f="connectedAppRecentId";s.getConnected=function(e){return t(regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o();case 2:return t=n.sent,e&&(t=t.filter(function(t){var n=!0;return angular.forEach(e,function(e,r){n=n&&t[r]===e}),n})),n.abrupt("return",t.map(function(e){return e.id}));case 5:case"end":return n.stop()}},n,this)}))},s.getConnectedAppInfo=t.wrap(regeneratorRuntime.mark(function d(){var e,t;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o();case 2:return e=r.sent,r.next=5,n.getApps(e.map(function(e){return e.id}));case 5:return t=r.sent,t=angular.copy(t),t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});angular.extend(t,n)}),r.abrupt("return",t);case 9:case"end":return r.stop()}},d,this)})),s.getConnectedAppInfoForApp=t.wrap(regeneratorRuntime.mark(function h(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.getConnectedAppInfo();case 2:if(t=r.sent,n=t.find(function(t){return t.id===e})){r.next=6;break}return r.abrupt("return",null);case 6:return r.abrupt("return",n);case 7:case"end":return r.stop()}},h,this)})),s.isConnected=function(e){return t(regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o();case 2:return t=n.sent,n.abrupt("return",u(t,e));case 4:case"end":return n.stop()}},n,this)}))},s.disconnect=function(e){return t(regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o();case 2:return t=n.sent,t=t.filter(function(t){return t.id!==e}),n.next=6,c(null);case 6:return n.next=8,i(t);case 8:r.$broadcast("connect:appDisconnected",e);case 9:case"end":return n.stop()}},n,this)}))},s.connect=function(e){return t(regeneratorRuntime.mark(function a(){var t,s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o();case 2:return t=a.sent,a.next=5,n.getAppInfo(e);case 5:if(s=a.sent,u(t,e)){a.next=11;break}if(t.push({id:e,hasShareUrl:!!s.shareUrl}),!s.shareUrl){a.next=11;break}return a.next=11,c(e);case 11:return a.next=13,i(t);case 13:r.$broadcast("connect:appConnected",e,s);case 14:case"end":return a.stop()}},a,this)}))};var p=t.wrap(regeneratorRuntime.mark(function m(e,t,n){var r,a,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,o();case 2:if(r=u.sent,a=r.find(function(t){return t.id===e})){u.next=6;break}throw new Error("Cannot set user data for non-connected app");case 6:return c=a[t],null===n||angular.isUndefined(n)?delete a[t]:a[t]=n,u.next=10,i(r);case 10:return u.abrupt("return",c);case 11:case"end":return u.stop()}},m,this)}));return s.setUserExpiryDate=t.wrap(regeneratorRuntime.mark(function g(e,t){var n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,p(e,"userExpiryDate",t);case 2:n=o.sent,r.$broadcast("connect:userExpiryDateChange",n,t);case 4:case"end":return o.stop()}},g,this)})),s.setUserShareUrl=function(e,t){return p(e,"shareUrl",t)},s.clearRecent=function(){return c(null)},s.getRecent=function(){return a()},s}]),angular.module("castifyExt.connect.appRegistry",["w69b.spawn","w69b.chromeStorage"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","chromeStorage",function(e,t,n,r,o){function i(){return o.local.getSingle(h,[])}function a(e){return o.local.setSingle(h,e)}function c(e){return i().then(function(t){return t.filter(function(t){return e.includes(t.id)})})}function u(e,t){var n=Date.now(),r=e.some(function(e){return n>e._fetchTimestamp+m});return!r&&t.length===e.length}function s(e){return e.forEach(function(e){delete e._fetchTimestamp}),e}function l(e,t){return r(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=new Set(e||[]),n.next=3,i();case 3:return r=n.sent,t.forEach(function(t){e.add(t.id)}),r=r.filter(function(t){return!e.has(t.id)}),t.forEach(function(e){e._fetchTimestamp=Date.now()}),r=r.concat(t),n.next=10,a(r);case 10:case"end":return n.stop()}},n,this)}))}function f(e){return r(regeneratorRuntime.mark(function o(){var r,i,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e&&0!==e.length){o.next=2;break}return o.abrupt("return",n.when([]));case 2:return o.next=4,c(e);case 4:if(i=o.sent,!u(i,e)){o.next=7;break}return o.abrupt("return",s(i));case 7:return o.prev=7,o.next=10,t.get(p,{params:{ids:e}});case 10:a=o.sent,r=a.data,o.next=17;break;case 14:return o.prev=14,o.t0=o["catch"](7),o.abrupt("return",s(i));case 17:return o.next=19,l(e,r);case 19:return o.abrupt("return",s(r));case 20:case"end":return o.stop()}},o,this,[[7,14]])}))}var p=e.API_URL+"/apps",d={},h="appRegistry:cache",m=6e4;return d.getApps=function(e){return f(e)},d.getAppInfo=function(e){return f([e]).then(function(e){return e.length?e[0]:n.reject()})},d}]),angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions"]).factory("optionalPermissions",["chromePermissions",function(e){function t(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox&&null===e.draw.tool)?o:r}var n={},r={permissions:["tabCapture","webNavigation","activeTab"],origins:["<all_urls>"]},o={permissions:["tabCapture","webNavigation","activeTab"],origins:[]};return n.hasLiteTabPermissions=function(){return e.contains(o)},n.hasTabPermissions=function(n){return e.contains(t(n))},n.requestTabPermissions=function(n){return e.request(t(n))},n}]),angular.module("castifyExt.hdpiTool",[]).factory("hdpiTool",["$window",function(e){var t={};return t.devicePixelRatio=e.devicePixelRatio,t.toPhysicalResolution=function(e){return{width:Math.floor(e.width*t.devicePixelRatio),height:Math.floor(e.height*t.devicePixelRatio)}},t.toCssResolution=function(e){return{width:Math.round(e.width/t.devicePixelRatio),height:Math.round(e.height/t.devicePixelRatio)}},t.getScreenCssResolution=function(){return{width:e.screen.width,height:e.screen.height}},t}]),angular.module("castifyExt.PopupApp",["ngAnimate","ngMaterial","ui.router","w69b.chromePersistentLogger","castifyExt.commonConfig","castifyExt.ui.recorder","castifyExt.ui.surveyFlow","castifyExt.ui.themeConfig","castifyExt.ui.openInAppTab","castifyExt.ui.topnav","castifyExt.ui.monthlyLimit","castifyExt.ui.sidenav","castifyExt.ui.loadingOverlay"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state({url:"/recorder",name:"recorder",component:"cfRecorder"}).state({name:"recorder.loading",component:"cfRecorderLoading"}).state({analyticsView:"Recorder - Setup",name:"recorder.inactive",component:"cfRecorderInactive"}).state({analyticsView:"Recoder - Recording",name:"recorder.recording",component:"cfRecorderRecording"}).state({url:"/survey",name:"surveyFlow",component:"cfSurveyFlow"}).state({analyticsView:"Sign In Request",name:"surveyFlow.signIn",component:"cfSignInRequest"}).state({analyticsView:"Tos Update",name:"surveyFlow.tos",component:"cfTosUpdate"}).state({analyticsView:"Monthly Limit Reached",name:"surveyFlow.monthlyLimitReached",component:"cfMonthlyLimitReached"}).state({analyticsView:"Monthly Limit Approaching",name:"surveyFlow.monthlyLimitApproaching",component:"cfMonthlyLimitApproaching"}).state({analyticsView:"Survey",name:"surveyFlow.survey",component:"cfSurveyFlowSurvey"}),t.otherwise("/survey")}]).config(["chromePersistentLoggerProvider",function(e){e.setStorageKey("popup"),e.enableGlobalHandler(!0),e.install()}]),angular.module("w69b.chromeAnalytics",[]).provider("analytics",function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,o=r.getService.apply(r,t),i=o.getTracker(e),a={};return a.tracker=i,a.eventBuilder=function(){return r.EventBuilder.builder()},a.setEnabled=function(e){o.getConfig().addCallback(function(t){t.setTrackingPermitted(e)})},a.send=function(){i.send.apply(i,arguments)},a.trackPageView=function(e){i.sendAppView(e)},a.trackEvent=function(){i.sendEvent.apply(i,arguments)},a.sendNonInteractionEvent=function(e,t,n,o){var i={eventCategory:e,eventAction:t,eventLabel:n,eventValue:o,nonInteraction:!0};a.send(r.HitTypes.EVENT,i)},a.trackTimer=function(e,t,n){var r,o={};return o.start=function(){return r=(new Date).getTime(),o},o.send=function(a,c,u){var s=(new Date).getTime();return i.sendTiming(a||e,c||t,s-r,u||n),o},o.start(),o},a}]}),angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc","$q",function(e,t,n){var r={};return r.tabCapture=function(){return chrome.tabCapture?e.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture).apply(null,arguments):n.reject("tabCapture permission missing")},chrome.desktopCapture&&(r.chooseDesktopMedia=function(){function t(e){chrome.desktopCapture.cancelChooseDesktopMedia(i),o.reject(e||"cancelled")}e.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture);var r=Array.prototype.slice.call(arguments,0),o=n.defer();r.push(function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)});var i=chrome.desktopCapture.chooseDesktopMedia.apply(chrome.desktopCapture,r);return{promise:o.promise,cancel:t}}),r.desktopCapture=function(e){var n={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}};return t.getUserMedia(n)},r}]),angular.module("w69b.chromePersistentLogger",["w69b.chromeStorage","w69b.logging","w69b.structs.CircularBuffer"]).provider("chromePersistentLogger",["$logProvider",function(e){function t(e,t){var r={level:e,args:t,timestamp:(new Date).getTime()};return n?n.add(r):o.push(r),!0}var n,r="logs",o=[],i=!1,a=1e3,c="logs_",u=!1,s=!0;this.setStorageKey=function(e){r=e},this.setMaxNumLogs=function(e){a=e},this.enableAutoLoad=function(e){i=e},this.enableAutoSave=function(e){s=e},this.enableGlobalHandler=function(e){u=e},this.install=function(){this.enableAutoLoad(!0),e.setCustomHook(t)},this.$get=["$window","$q","chromeStorage","CircularBuffer","$log",function(e,l,f,p,d){function h(e){var t=e.args.map(function(e){if(!angular.isObject(e))return e;try{return angular.toJson(e)}catch(t){return e}});return[new Date(e.timestamp).toISOString(),e.level.toUpperCase(),t.join(", ")].join(" ")}function m(e){var t=new p(a);return e.forEach(function(e){t.add(e)}),t}var g={};return g.load=function(){return f.local.getSingle(c+r).then(function(e){e&&e.length&&(n=m(e.concat(g.getEntries())))})},g.save=function(e){return f.local.setSingle(c+(e||r),g.getEntries())},g.clear=function(){n.clear()},g.getEntries=function(){return n.getValues()},g.getLogs=function(){return g.getEntries().map(h)},g.getMergedLogs=function(e){return e=e.map(function(e){return c+e}),f.local.get(e).then(function(e){var t=[];return angular.forEach(e,function(e,n){e&&e.length&&e.forEach(function(e){e.storageKey=n.substr(c.length),t.push(e)})}),t.sort(function(e,t){return e.timestamp-t.timestamp}),t.map(function(e){return"["+e.storageKey+"] "+h(e)})})},g.hookFn=t,n=m(o),o=null,i&&g.load(),u&&(e.onerror=function(e,t,n){d.error("global error",e,t,n)}),s&&e.addEventListener("unload",function(){g.save()}),g}]}]).run(["chromePersistentLogger",angular.noop]),angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),t.setUninstallURL=e.wrapChromeError(chrome.runtime.setUninstallURL,chrome.runtime),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach(function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}}),t}]),angular.module("w69b.chromeStorage",["w69b.promiseTool"]).factory("chromeStorage",["promiseTool",function(e){var t=chrome.storage,n={};return["local","sync","managed"].forEach(function(r){n[r]={},["set","get","remove","clear"].forEach(function(o){n[r][o]=e.wrapChromeError(t[r][o],t[r])}),n[r].setSingle=function(e,t){var o={};return o[e]=t,n[r].set(o)},n[r].getSingle=function(e,t){return n[r].get(e).then(function(n){return n.hasOwnProperty(e)?n[e]:t})}}),n.onChanged=t.onChanged,n}]),angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,o={};return o.query=t.wrapChromeError(r.tabs.query,r.tabs),o.getActiveTab=function(){return o.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then(function(e){return e.length?e[0]:n.reject()})},o.get=t.wrapChromeError(r.tabs.get,r.tabs),o.update=t.wrapChromeError(r.tabs.update,r.tabs),o.remove=t.wrapChromeError(r.tabs.remove,r.tabs),o.create=t.wrapChromeError(r.tabs.create,r.tabs),o.connect=r.tabs.connect.bind(r.tabs),o.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),o.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),o.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),o.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),o.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),o.onUpdated=r.tabs.onUpdated,o.onActivated=r.tabs.onActivated,o.sendMessageActive=function(e,t){return o.getActiveTab().then(function(n){return o.sendMessage(n.id,e,t)})},o}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",function(t){t.preventDefault(),e.create({url:r.href}).then(function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)})})}}}]),angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}]),angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(n,r,o){function i(){return f||(f=o.get(t)),f}function a(e){return i().getAuthToken(e)}function c(e){return{Authorization:"Bearer "+e}}function u(){return l||(l=o.get("$http")),l}function s(t){var o=t.status;if(401==o&&t.config.googleAuth&&t.config.authAutoRetry!==!1){r.debug("auth error detected",t);var i=angular.copy(t.config);if(i.authRetryCount?i.authRetryCount++:i.authRetryCount=1,i.authRetryCount<=e)return a({scopes:i.googleAuthScopes,validate:!0
}).then(function(){return r.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),u()(i)})}return n.reject(t)}var l,f;return{request:function(e){return e.googleAuth?a({scopes:e.googleAuthScopes}).then(function(t){return e.headers=angular.extend(e.headers||{},c(t)),e},function(e){return r.warn("googleAuthHttpInterceptor: no token, aborting request",e),n.reject("googleAuthFailed")}):e},responseError:s}}]}),angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){function r(e){var t=e.split("/"),n=t.slice(0,-1).join("/"),r=t.slice(-1)[0];return[n,r]}e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var o=window.PERSISTENT,i=104857600,a={},c=["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"];return c.forEach(function(e){a[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}}),a.getFileSystem=function(n,r){return angular.isUndefined(n)&&(n=o),r=r||i,t.wrapCallbacks(e.requestFileSystem,e)(n,r)},a.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,n){t.resolve({usage:e,quota:n})},function(e){t.reject(e)}),t.promise},chrome.system&&chrome.system.storage&&(a.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),a.getDirByPath=function(e,t){function r(e,o){return o.length?a.getDirectory(e,o[0],t||{}).then(function(e){return r(e,o.slice(1))}):n.when(e)}var o=e.split("/");return""===o[0]&&o.splice(0,1),a.getFileSystem().then(function(e){return r(e.root,o,t)})},a.moveFileByPath=function(e,t){var o=r(t),i=o[0],c=o[1];return n.all({file:a.getFileEntryByPath(e),targetDir:a.getDirByPath(i)}).then(function(e){return a.moveTo(e.file,e.targetDir,c)})},a.getFileEntryByPath=function(e,t,n){var o=r(e),i=o[0],c=o[1];return a.getDirByPath(i,n).then(function(e){return a.getFile(e,c,t||{})})},a.getFileByPath=function(e){return a.getFileEntryByPath(e).then(function(e){return a.file(e)})},a.removeByPath=function(e){return a.getFileEntryByPath(e).then(function(e){return a.remove(e)})},a.listByPath=function(e){return a.getDirByPath(e).then(function(e){var t=e.createReader();return a.readEntries(t)})},a.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||i)},a.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||i)},a.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},a.isSupported=function(){return!!window.requestFileSystem},a}]),angular.module("w69b.logging",[]).provider("$log",function(){var e=!0,t=this,n=!1;this.debugEnabled=function(t){return angular.isDefined(t)?(e=t,this):e},this.setCustomHook=function(e){n=e},this.$get=["$window",function(r){function o(e){return e instanceof Error&&(e.stack?e=e.message&&e.stack.indexOf(e.message)===-1?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line)),e}function i(e){var t=r.console||{},i=t[e]||t.log||angular.noop,a=!1;try{a=!!i.apply}catch(c){}return a?function(){var r=[];if(angular.forEach(arguments,function(e){r.push(o(e))}),n&&n(e,r))return i.apply(t,r)}:function(t,r){n&&n(e,[t,r])&&i(t,null===r?"":r)}}return{log:i("log"),info:i("info"),warn:i("warn"),error:i("error"),debug:function(){var n=i("debug");return function(){e&&n.apply(t,arguments)}}()}}]}),angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){var n={};return n.wrapChromeError=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push(function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)}),t.apply(n,r),o.promise}},n.wrapCallbacks=function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push(o.resolve.bind(o)),r.push(o.reject.bind(o)),t.apply(n,r),o.promise}},n.serializer=function(){var t=null,n=function(n){var r=e.defer();return(t||e.when())["finally"](function(){var e=n.call();r.resolve(e)}),t=r.promise,t["finally"](function(){t=null}),r.promise};return n.wrap=function(e){return function(){return n(e.bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))))}},n},n.withTimeout=function(n,r,o){o||(o=angular.noop);var i=e.defer(),a=t(function(){var e=o();angular.isDefined(e)?i.resolve(e):i.reject("timeout"),i=null},r),c=n(),u=i.promise;return c["finally"](function(){t.cancel(a),a=null}),c.then(function(){i&&i.resolve.apply(i,arguments)},function(){i&&i.reject.apply(i,arguments)}),u},n}]),angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),n=this.getCount()-e,r=[],o=n;o<t;o++)r.push(this.get(o));return r},t.getKeys=function(){for(var e=[],t=this.getCount(),n=0;n<t;n++)e[n]=n;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),n=0;n<t;n++)if(this.get(n)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}),angular.module("w69b.spawn",[]).factory("spawn",["$q","$log",function(e,t){function n(t,n){function r(e,t){var n;try{n=e(t)}catch(r){return o(r)}return n.done?i(n.value):i(n.value).then(c,u)}var o=n?Promise.reject.bind(Promise):e.reject.bind(e),i=n?Promise.resolve.bind(Promise):e.when.bind(e),a=t(),c=r.bind(null,a.next.bind(a)),u=r.bind(null,a["throw"].bind(a));return c()}return n.wrap=function(e){return function(){var t=arguments;return n(e.bind.apply(e,[this].concat(_toConsumableArray(t))))}},n}]),angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){function t(t,n,r){var o,i,a;r=r!==!1;var c=function(){return a=angular.copy(arguments,[]),i=function(){return o=null,i=null,t.apply(null,a)},r?(o&&e.cancel(o),o=e(i,n)):o||(o=e(i,n)),o};return c.flush=function(){o&&(e.cancel(o),i())},c}return t}]),angular.module("w69b.timeutil",[]).factory("timeutil",function(){var e={};return e.formatDuration=function(e){function t(e){return e<10?"0"+e:e}angular.isNumber(e)||(e=0);var n="";e<0&&(n="-",e=-e+.99);var r=Math.floor(e%60),o=Math.floor(e/60%60),i=[t(o),t(r)],a=Math.floor(e/3600);return a&&i.unshift(a),n+i.join(":")},e}).filter("duration",["timeutil",function(e){return function(t){return e.formatDuration(t||0)}}]),angular.module("w69b.uritool",[]).factory("uritool",function(){function e(e){return decodeURIComponent(e.replace(t," "))}var t=/\+/g,n={};return n.parseQuery=function(t,n){"?"==t[0]&&(t=t.substring(1));for(var r,o=/([^&=]+)=?([^&]*)/g,i={};r=o.exec(t);){var a=e(r[1]),c=e(r[2]);n&&i.hasOwnProperty(a)?i[a].push(c):i[a]=n?[c]:c}return i},n.parseUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},n.encodeQuery=function(e){var t=[];return angular.forEach(e,function(e,n){angular.isArray(e)?angular.forEach(e,function(e){t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}):t.push(encodeURIComponent(n)+(e===!0?"":"="+encodeURIComponent(e)))}),t.length?t.join("&"):""},n}),angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function n(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}return n}]),angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){function t(t,r){return n||(n=e.get("$filter")("number")),n(t,r)}var n;return function(e,n){if(!angular.isNumber(e))return"-";if(angular.isUndefined(n)&&(n=1),e<=0)return"0 B";var r=["B","KB","MB","GB","TB","PB"],o=Math.floor(Math.log(e)/Math.log(1024));return t(e/Math.pow(1024,Math.floor(o)),n)+" "+r[o]}}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(e,t,n){function r(e){return e.some(function(e){return!!e.label})}var o={},i=t.navigator;return o.getUserMedia=e.wrapCallbacks(i.getUserMedia||i.webkitGetUserMedia||i.mozGetUserMedia||i.msGetUserMedia,i),i.mediaDevices&&i.mediaDevices.enumerateDevices?o.getSources=function(){return n.when(i.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t})})}:o.getSources=e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),o.getSourcesByKind=function(e){return o.getSources().then(function(t){return t.filter(function(t){return t.kind===e})})},o.getVideoSources=function(){return o.getSourcesByKind("video")},o.getAudioSources=function(){return o.getSourcesByKind("audio")},o.hasCamera=function(){return o.getVideoSources().then(function(e){return e.length>0})},o.hasMicrophone=function(){return o.getAudioSources().then(function(e){return e.length>0})},o.hasVideoAccess=function(){return o.getVideoSources().then(r)},o.hasAudioAccess=function(){return o.getAudioSources().then(r)},o}]),angular.module("w69b.ui.focus",[]).directive("wbLoopFocus",["$document","$timeout",function(e,t){return{restrict:"A",link:function(n,r){function o(){var e=a.querySelector('input:not([tabindex^="-"]),textarea:not([tabindex^="-"]),button:not([tabindex^="-"]),*[tabindex]:not([tabindex^="-"])');e&&e.focus()}function i(e){var n=e.target;e.relatedTarget||a.contains(n)&&n!==a||t(o)}var a=r[0];r.attr("tabindex",-1);var c=e.find("body");c[0].addEventListener("focus",i,!0),r.on("$destroy",function(){c[0].removeEventListener("focus",i,!0)})}}}]).directive("wbFocus",["$timeout",function(e){return{link:function(t,n,r){t.$watch(r.wbFocus,function(t){t&&e(function(){n[0].focus(),n[0].select&&n[0].select()})},!0),n.bind("blur",function(){angular.isDefined(r.wbFocusLost)&&t.$apply(r.wbFocusLost)})}}}]).directive("wbAutoselect",["$timeout",function(e){return{link:function(t,n){n.bind("focus click",function(){e(function(){n[0].select()})})}}}]),angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,n={};return t?(n.contains=e.wrapChromeError(t.contains,t),n.request=e.wrapChromeError(t.request,t),n.remove=e.wrapChromeError(t.remove,t),n.getAll=e.wrapChromeError(t.getAll,t),n):n}]),angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,n={};return t?(t.cpu&&(n.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(n.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),n):n}]),angular.module("castifyExt.PopupApp").requires.push("templates")}();