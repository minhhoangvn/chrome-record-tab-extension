"use strict";!function(){angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,r){var n={};return n.wrapChromeError=function(r,n){return function(){var t=Array.prototype.slice.call(arguments,0),i=e.defer();return t.push(function(e){chrome.runtime.lastError?i.reject(chrome.runtime.lastError):i.resolve(e)}),r.apply(n,t),i.promise}},n.wrapCallbacks=function(r,n){return function(){var t=Array.prototype.slice.call(arguments,0),i=e.defer();return t.push(i.resolve.bind(i)),t.push(i.reject.bind(i)),r.apply(n,t),i.promise}},n.serializer=function(){var r=null,n=function(n){var t=e.defer();return(r||e.when())["finally"](function(){var e=n.call();t.resolve(e)}),r=t.promise,r["finally"](function(){r=null}),t.promise};return n.wrap=function(e){return function(){return n(e.bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))))}},n},n.withTimeout=function(n,t,i){i||(i=angular.noop);var o=e.defer(),u=r(function(){var e=i();angular.isDefined(e)?o.resolve(e):o.reject("timeout"),o=null},t),c=n(),a=o.promise;return c["finally"](function(){r.cancel(u),u=null}),c.then(function(){o&&o.resolve.apply(o,arguments)},function(){o&&o.reject.apply(o,arguments)}),a},n}]),angular.module("w69b.webrtc",["w69b.promiseTool"]).factory("webrtc",["promiseTool","$window","$q",function(e,r,n){function t(e){return e.some(function(e){return!!e.label})}var i={},o=r.navigator;return i.getUserMedia=e.wrapCallbacks(o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,o),o.mediaDevices&&o.mediaDevices.enumerateDevices?i.getSources=function(){return n.when(o.mediaDevices.enumerateDevices()).then(function(e){return e.filter(function(e){return e.kind.endsWith("input")}).map(function(e){var r={id:e.deviceId,label:e.label};return r.kind=e.kind.substring(0,e.kind.length-5),r})})}:i.getSources=e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),i.getSourcesByKind=function(e){return i.getSources().then(function(r){return r.filter(function(r){return r.kind===e})})},i.getVideoSources=function(){return i.getSourcesByKind("video")},i.getAudioSources=function(){return i.getSourcesByKind("audio")},i.hasCamera=function(){return i.getVideoSources().then(function(e){return e.length>0})},i.hasMicrophone=function(){return i.getAudioSources().then(function(e){return e.length>0})},i.hasVideoAccess=function(){return i.getVideoSources().then(t)},i.hasAudioAccess=function(){return i.getAudioSources().then(t)},i}]),angular.module("castifyExt.MicApp",["castifyExt.mic.ui","ngMaterial"]),angular.module("castifyExt.mic.ui",["w69b.webrtc"]).controller("MicStreamCtrl",["$scope","webrtc","$window","$log",function(e,r,n,t){function i(){r.hasCamera().then(function(i){r.getUserMedia({audio:!0,video:i}).then(function(r){e.state="success";var t=!!r.getVideoTracks().length;r.getTracks().forEach(function(e){e.stop()}),n.clGotStream&&(n.clGotStream(),n.close()),!t&&i&&(e.state="error")},function(r){t.info(r),e.state="error"})})}e.state="init",e.record=i,i()}])}();